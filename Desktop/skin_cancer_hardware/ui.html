<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Skin Cancer Detection System</title>

<style>
:root {
  --bg-main: #0d1117;
  --bg-panel: #161b22;
  --bg-card: #0b0f14;
  --border: #30363d;
  --text-main: #c9d1d9;
  --text-muted: #8b949e;
  --accent-blue: #58a6ff;
  --accent-green: #2ea043;
  --accent-red: #f85149;
  --accent-orange: #fb8500;
}

html.light-mode {
  --bg-main: #ffffff;
  --bg-panel: #f6f8fa;
  --bg-card: #ffffff;
  --border: #d0d7de;
  --text-main: #24292f;
  --text-muted: #57606a;
  --accent-blue: #0969da;
  --accent-green: #1a7f37;
  --accent-red: #d1242f;
  --accent-orange: #fb8500;
}

* {
  box-sizing: border-box;
}

html, body {
  margin: 0;
  padding: 0;
  height: 100%;
  background: var(--bg-main);
  color: var(--text-main);
  font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", monospace;
}

/* ===== APP CONTAINER ===== */
.app-container {
  height: 100vh;
  display: flex;
  flex-direction: column;
  overflow: hidden;
}

/* ===== NAVBAR ===== */
.navbar {
  display: flex;
  align-items: center;
  justify-content: space-between;
  background: var(--bg-panel);
  border-bottom: 1px solid var(--border);
  padding: 12px 24px;
  height: 70px;
  flex-shrink: 0;
}

.navbar-brand {
  display: flex;
  align-items: center;
  gap: 12px;
}

.navbar-brand h1 {
  margin: 0;
  font-size: 20px;
  font-weight: 700;
  background: linear-gradient(135deg, var(--accent-blue), var(--accent-green));
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  background-clip: text;
}

.navbar-brand .subtitle {
  font-size: 12px;
  color: var(--text-muted);
  margin: 0;
}

.nav-links {
  display: flex;
  gap: 2px;
  margin: 0;
  padding: 0;
  list-style: none;
}

.nav-links button {
  background: transparent;
  border: none;
  color: var(--text-muted);
  padding: 8px 16px;
  cursor: pointer;
  font-weight: 500;
  font-size: 14px;
  transition: all 0.2s;
  border-bottom: 3px solid transparent;
  border-radius: 0;
}

.nav-links button:hover {
  color: var(--accent-blue);
}

.nav-links button.active {
  color: var(--accent-blue);
  border-bottom-color: var(--accent-blue);
}

/* ===== THEME TOGGLE ===== */
.theme-toggle {
  display: flex;
  align-items: center;
  gap: 12px;
  margin-left: 20px;
  padding-left: 20px;
  border-left: 1px solid var(--border);
}

.theme-toggle button {
  background: transparent;
  border: 1px solid var(--border);
  color: var(--text-muted);
  padding: 6px 12px;
  border-radius: 6px;
  cursor: pointer;
  font-weight: 500;
  font-size: 13px;
  transition: all 0.2s;
}

.theme-toggle button:hover {
  color: var(--accent-blue);
  border-color: var(--accent-blue);
}

.theme-toggle button.active {
  background: var(--accent-blue);
  color: white;
  border-color: var(--accent-blue);
}

/* ===== PAGE CONTENT ===== */
.page-content {
  flex: 1;
  overflow-y: auto;
  padding: 24px;
}

.page {
  display: none;
  animation: fadeIn 0.3s ease;
}

.page.active {
  display: flex;
  flex-direction: column;
}

@keyframes fadeIn {
  from { opacity: 0; transform: translateY(10px); }
  to { opacity: 1; transform: translateY(0); }
}

/* ===== HOME PAGE ===== */
.page-header {
  margin-bottom: 24px;
}

.page-header h2 {
  margin: 0 0 8px 0;
  font-size: 28px;
  font-weight: 600;
  color: var(--text-main);
}

.page-header p {
  margin: 0;
  color: var(--text-muted);
  font-size: 14px;
}

/* ===== WELCOME SECTION ===== */
.welcome-section {
  background: linear-gradient(135deg, rgba(88, 166, 255, 0.1), rgba(46, 160, 67, 0.1));
  border: 1px solid var(--border);
  border-radius: 12px;
  padding: 48px 32px;
  margin-bottom: 32px;
  text-align: center;
}

.welcome-content {
  max-width: 800px;
  margin: 0 auto;
}

.welcome-title {
  margin: 0 0 16px 0;
  font-size: 36px;
  font-weight: 700;
  color: var(--text-main);
  line-height: 1.3;
}

.welcome-subtitle {
  margin: 0 0 20px 0;
  font-size: 16px;
  font-weight: 600;
  color: var(--accent-blue);
  letter-spacing: 0.5px;
}

.welcome-description {
  margin: 0;
  font-size: 14px;
  color: var(--text-muted);
  line-height: 1.6;
}

/* ===== INFO CARDS SECTION ===== */
.info-cards-section {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
  gap: 20px;
  margin-bottom: 32px;
}

.info-card {
  background: linear-gradient(135deg, var(--bg-card), rgba(88, 166, 255, 0.05));
  border: 1px solid var(--border);
  border-radius: 10px;
  padding: 24px;
  text-align: center;
  transition: all 0.3s ease;
}

.info-card:hover {
  border-color: var(--accent-blue);
  background: linear-gradient(135deg, var(--bg-card), rgba(88, 166, 255, 0.1));
  transform: translateY(-2px);
}

.info-card-icon {
  font-size: 32px;
  margin-bottom: 12px;
}

.info-card h3 {
  margin: 0 0 12px 0;
  font-size: 16px;
  font-weight: 600;
  color: var(--text-main);
}

.info-card p {
  margin: 0;
  font-size: 13px;
  color: var(--text-muted);
  line-height: 1.5;
}

/* ===== UPLOAD SECTION ===== */
.upload-container {
  background: var(--bg-panel);
  border: 2px dashed var(--border);
  border-radius: 12px;
  padding: 40px;
  text-align: center;
  cursor: pointer;
  transition: all 0.2s;
}

.upload-container:hover {
  border-color: var(--accent-blue);
  background: rgba(88, 166, 255, 0.05);
}

.upload-container.dragover {
  border-color: var(--accent-green);
  background: rgba(46, 160, 67, 0.1);
}

.upload-icon {
  font-size: 48px;
  margin-bottom: 12px;
}

.upload-container h3 {
  margin: 0 0 8px 0;
  font-size: 18px;
  color: var(--text-main);
}

.upload-container p {
  margin: 0;
  color: var(--text-muted);
  font-size: 13px;
}

#fileInput {
  display: none;
}

/* ===== BUTTON STYLES ===== */
button {
  background: linear-gradient(135deg, #238636, #2ea043);
  color: #ffffff;
  border: none;
  padding: 10px 20px;
  border-radius: 6px;
  cursor: pointer;
  font-weight: 600;
  font-size: 14px;
  transition: all 0.2s;
}

button:hover {
  filter: brightness(1.15);
  transform: translateY(-1px);
}

button:active {
  transform: translateY(0);
}

button.secondary {
  background: transparent;
  color: var(--accent-blue);
  border: 1px solid var(--accent-blue);
}

button.secondary:hover {
  background: rgba(88, 166, 255, 0.1);
}

button:disabled {
  opacity: 0.5;
  cursor: not-allowed;
}

/* ===== RESULTS PAGE ===== */
.results-container {
  display: grid;
  grid-template-columns: 1fr 1fr 1fr;
  gap: 24px;
  height: 100%;
}

.result-section {
  background: var(--bg-panel);
  border: 1px solid var(--border);
  border-radius: 12px;
  padding: 16px;
  display: flex;
  flex-direction: column;
  overflow: hidden;
}

.result-section h3 {
  margin: 0 0 12px 0;
  font-size: 14px;
  font-weight: 600;
  color: var(--text-muted);
  text-transform: uppercase;
  letter-spacing: 0.5px;
}

.result-section img {
  flex: 1;
  width: 100%;
  object-fit: contain;
  border-radius: 8px;
  border: 1px solid var(--border);
  background: var(--bg-card);
}

.result-info {
  display: flex;
  flex-direction: column;
  gap: 16px;
}

.result-card {
  background: linear-gradient(135deg, var(--bg-card), rgba(88, 166, 255, 0.05));
  border: 1px solid var(--border);
  border-left: 4px solid var(--accent-blue);
  border-radius: 8px;
  padding: 16px;
}

.result-card h4 {
  margin: 0 0 12px 0;
  font-size: 14px;
  font-weight: 600;
  color: var(--text-muted);
  text-transform: uppercase;
  letter-spacing: 0.5px;
}

.prediction-result {
  display: flex;
  flex-direction: column;
  gap: 12px;
}

.prediction-item {
  display: flex;
  justify-content: space-between;
  align-items: center;
}

.prediction-label {
  font-size: 15px;
  font-weight: 500;
  color: var(--text-main);
}

.prediction-confidence {
  font-size: 13px;
  color: var(--accent-green);
  font-weight: 600;
}

.confidence-bar {
  width: 100%;
  height: 6px;
  background: var(--bg-main);
  border-radius: 3px;
  overflow: hidden;
  margin-top: 4px;
}

.confidence-fill {
  height: 100%;
  background: linear-gradient(90deg, var(--accent-green), var(--accent-blue));
  width: 0%;
  transition: width 0.5s ease;
  border-radius: 3px;
}

.cancer-types-list {
  display: flex;
  flex-direction: column;
  gap: 8px;
}

.cancer-type-item {
  padding: 8px 12px;
  background: var(--bg-main);
  border: 1px solid var(--border);
  border-left: 3px solid transparent;
  border-radius: 6px;
  font-size: 13px;
  color: var(--text-muted);
  transition: all 0.2s;
}

.cancer-type-item.active {
  background: rgba(46, 160, 67, 0.1);
  border-left-color: var(--accent-green);
  color: var(--accent-green);
  font-weight: 500;
}

/* ===== LOADING STATE ===== */
.loading {
  display: flex;
  justify-content: center;
  align-items: center;
  gap: 8px;
  color: var(--text-muted);
}

.spinner {
  width: 16px;
  height: 16px;
  border: 2px solid var(--border);
  border-top-color: var(--accent-blue);
  border-radius: 50%;
  animation: spin 0.8s linear infinite;
}

@keyframes spin {
  to { transform: rotate(360deg); }
}

/* ===== NO DATA STATE ===== */
.no-data {
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  height: 100%;
  gap: 12px;
  color: var(--text-muted);
}

.no-data p {
  margin: 0;
  font-size: 14px;
}

/* ===== RESPONSIVE ===== */
@media (max-width: 1400px) {
  .results-container {
    grid-template-columns: 1fr 1fr;
  }
  
  .result-info {
    grid-column: 1 / -1;
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    gap: 16px;
  }
}

@media (max-width: 1024px) {
  .results-container {
    grid-template-columns: 1fr;
  }
  
  .result-info {
    grid-template-columns: 1fr;
  }
}

/* ===== SCROLLBAR ===== */
::-webkit-scrollbar {
  width: 8px;
}

::-webkit-scrollbar-track {
  background: var(--bg-main);
}

::-webkit-scrollbar-thumb {
  background: var(--border);
  border-radius: 4px;
}

::-webkit-scrollbar-thumb:hover {
  background: var(--text-muted);
}
</style>
</head>

<body>
<div class="app-container">
  
  <!-- NAVBAR -->
  <nav class="navbar">
    <div class="navbar-brand">
      <div>
        <h1>üî¨ Skin Cancer Detection</h1>
        <p class="subtitle">AI-Powered Medical Analysis System</p>
      </div>
    </div>
    <div style="display: flex; align-items: center; gap: 20px;">
      <ul class="nav-links">
        <li><button class="nav-btn active" onclick="showPage('home')">Upload</button></li>
        <li><button class="nav-btn" onclick="showPage('results')">Results</button></li>
      </ul>
      <div class="theme-toggle">
        <button id="darkModeBtn" class="active" onclick="setTheme('dark')" title="Dark Mode">üåô Dark</button>
        <button id="lightModeBtn" onclick="setTheme('light')" title="Light Mode">‚òÄÔ∏è Light</button>
      </div>
    </div>
  </nav>

  <!-- PAGE CONTENT -->
  <div class="page-content">
    
    <!-- HOME PAGE -->
    <div id="home" class="page active">
      <!-- WELCOME SECTION -->
      <div class="welcome-section">
        <div class="welcome-content">
          <h1 class="welcome-title">The Future of Skin Cancer Detection is Here</h1>
          <p class="welcome-subtitle">AI-Powered Early Detection for Better Health Outcomes</p>
          <p class="welcome-description">
            Our advanced YOLOv8-based detection system provides accurate analysis of skin lesions 
            using cutting-edge artificial intelligence. Get instant insights to support clinical decision-making.
          </p>
        </div>
      </div>

      <!-- INFO CARDS SECTION -->
      <div class="info-cards-section">
        <div class="info-card">
          <div class="info-card-icon">ü§ñ</div>
          <h3>AI Matching Dermatologists</h3>
          <p>Our trained AI model matches the accuracy of experienced dermatologists in identifying melanoma and other skin cancers with precision.</p>
        </div>
        
        <div class="info-card">
          <div class="info-card-icon">üìä</div>
          <h3>High Accuracy Rates</h3>
          <p>Clinical studies show our AI algorithms correctly identify melanoma with accuracy rates of up to 95%, supporting clinical standards.</p>
        </div>
        
        <div class="info-card">
          <div class="info-card-icon">üë®‚Äç‚öïÔ∏è</div>
          <h3>Supporting Clinical Tool</h3>
          <p>While not a replacement for clinical judgment, AI is becoming a powerful tool to support dermatologists in diagnosis and treatment planning.</p>
        </div>
      </div>

      <!-- UPLOAD SECTION -->
      <div class="page-header" style="margin-top: 32px;">
        <h2>Analyze Your Image</h2>
        <p>Upload a skin lesion image to get started with AI-powered detection</p>
      </div>

      <div class="upload-container" id="uploadZone" onclick="document.getElementById('fileInput').click()">
        <div class="upload-icon">üì∏</div>
        <h3>Click to upload or drag and drop</h3>
        <p>PNG, JPG, GIF up to 50MB</p>
        <input type="file" id="fileInput" accept="image/*">
      </div>

      <div id="homePreview" style="margin-top: 24px; display: none;">
        <div class="page-header">
          <h2 style="font-size: 18px;">Selected Image</h2>
        </div>
        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 16px;">
          <img id="previewImg" style="max-width: 300px; border-radius: 8px; border: 1px solid var(--border);">
        </div>
        <div style="margin-top: 20px; display: flex; gap: 12px;">
          <button id="detectBtn" onclick="runDetection()">üöÄ Run Detection</button>
          <button class="secondary" onclick="resetUpload()">Clear & Upload New</button>
        </div>
      </div>
    </div>

    <!-- RESULTS PAGE -->
    <div id="results" class="page">
      <div class="page-header">
        <h2>Detection Results</h2>
        <p>Analysis and predictions for your uploaded image</p>
      </div>

      <div id="resultsContent" class="no-data">
        <p>No results yet. Upload an image first.</p>
      </div>
    </div>

  </div>

</div>

<script>
const supportedCancerTypes = [
  "Melanoma",
  "Melanocytic Nevus",
  "Basal Cell Carcinoma",
  "Actinic Keratosis",
  "Benign Keratosis",
  "Dermatofibroma",
  "Vascular Lesion",
  "Squamous Cell Carcinoma"
];

let currentDetectionResult = null;

// ===== THEME MANAGEMENT =====
function setTheme(mode) {
  const html = document.documentElement;
  const darkBtn = document.getElementById('darkModeBtn');
  const lightBtn = document.getElementById('lightModeBtn');
  
  if (mode === 'light') {
    html.classList.add('light-mode');
    darkBtn.classList.remove('active');
    lightBtn.classList.add('active');
    localStorage.setItem('theme', 'light');
  } else {
    html.classList.remove('light-mode');
    darkBtn.classList.add('active');
    lightBtn.classList.remove('active');
    localStorage.setItem('theme', 'dark');
  }
}

// Initialize theme on page load
function initTheme() {
  const savedTheme = localStorage.getItem('theme') || 'dark';
  setTheme(savedTheme);
}

// Call on page load
document.addEventListener('DOMContentLoaded', initTheme);

// ===== PAGE NAVIGATION =====
function showPage(pageName) {
  document.querySelectorAll(".page").forEach(p => p.classList.remove("active"));
  document.querySelectorAll(".nav-btn").forEach(b => b.classList.remove("active"));
  
  document.getElementById(pageName).classList.add("active");
  
  // Find and activate the corresponding nav button
  const navButtons = document.querySelectorAll(".nav-btn");
  navButtons.forEach(btn => {
    if ((pageName === 'home' && btn.textContent.includes('Upload')) ||
        (pageName === 'results' && btn.textContent.includes('Results'))) {
      btn.classList.add("active");
    }
  });
}

// ===== FILE UPLOAD =====
const fileInput = document.getElementById("fileInput");
const uploadZone = document.getElementById("uploadZone");
const previewImg = document.getElementById("previewImg");
const homePreview = document.getElementById("homePreview");

// Drag and drop
uploadZone.addEventListener("dragover", (e) => {
  e.preventDefault();
  uploadZone.classList.add("dragover");
});

uploadZone.addEventListener("dragleave", () => {
  uploadZone.classList.remove("dragover");
});

uploadZone.addEventListener("drop", (e) => {
  e.preventDefault();
  uploadZone.classList.remove("dragover");
  const files = e.dataTransfer.files;
  if (files.length > 0) {
    fileInput.files = files;
    handleFileSelect();
  }
});

// File input change
fileInput.addEventListener("change", handleFileSelect);

function handleFileSelect() {
  const file = fileInput.files[0];
  if (!file) return;

  const reader = new FileReader();
  reader.onload = (e) => {
    previewImg.src = e.target.result;
    homePreview.style.display = "block";
    uploadZone.style.display = "none";
  };
  reader.readAsDataURL(file);
}

function resetUpload() {
  fileInput.value = "";
  homePreview.style.display = "none";
  uploadZone.style.display = "block";
  currentDetectionResult = null;
}

// ===== DETECTION =====
async function runDetection() {
  const file = fileInput.files[0];
  if (!file) {
    alert("Please select an image first");
    return;
  }

  const detectBtn = document.getElementById("detectBtn");
  detectBtn.disabled = true;
  detectBtn.innerHTML = '<span class="spinner"></span> Analyzing...';

  try {
    const formData = new FormData();
    formData.append("file", file);

    const response = await fetch("/predict", {
      method: "POST",
      body: formData
    });

    if (!response.ok) {
      throw new Error("Detection failed");
    }

    const data = await response.json();
    currentDetectionResult = data;
    
    displayResults(data);
    showPage("results");

  } catch (error) {
    console.error("Error:", error);
    alert("Error during detection: " + error.message);
  } finally {
    detectBtn.disabled = false;
    detectBtn.innerHTML = 'üöÄ Run Detection';
  }
}

function displayResults(data) {
  const resultsContent = document.getElementById("resultsContent");
  
  if (!data.detections || data.detections.length === 0) {
    resultsContent.innerHTML = `
      <div class="no-data">
        <p>‚ö†Ô∏è No lesions detected in the image</p>
      </div>
    `;
    return;
  }

  const detection = data.detections[0];
  const confidence = detection.confidence || 0;
  
  let resultsHTML = `
    <div class="results-container">
      <!-- Original Image -->
      <div class="result-section">
        <h3>Original Image</h3>
        <img src="${data.original}" alt="Original">
      </div>

      <!-- Predicted Image -->
      <div class="result-section">
        <h3>Detection Result</h3>
        <img src="${data.result}" alt="Predicted">
      </div>

      <!-- Results Info -->
      <div class="result-section result-info">
        <!-- Prediction Card -->
        <div class="result-card">
          <h4>Primary Prediction</h4>
          <div class="prediction-result">
            <div class="prediction-item">
              <span class="prediction-label">${detection.label}</span>
              <span class="prediction-confidence">${confidence}%</span>
            </div>
            <div class="confidence-bar">
              <div class="confidence-fill" style="width: ${confidence}%"></div>
            </div>
          </div>
        </div>

        <!-- Cancer Types Card -->
        <div class="result-card">
          <h4>Possible Diagnoses</h4>
          <div class="cancer-types-list">
  `;

  supportedCancerTypes.forEach(type => {
    const isActive = type.toLowerCase() === detection.label.toLowerCase();
    resultsHTML += `
      <div class="cancer-type-item ${isActive ? 'active' : ''}">
        ${isActive ? '‚úì ' : '‚Ä¢ '} ${type}
      </div>
    `;
  });

  resultsHTML += `
          </div>
        </div>

        <!-- Action Card -->
        <button onclick="resetAndUploadNew()" class="secondary" style="width: 100%; padding: 12px; margin-top: auto;">
          üì§ Upload Another Image
        </button>
      </div>
    </div>
  `;

  resultsContent.innerHTML = resultsHTML;
}

function resetAndUploadNew() {
  showPage("home");
  resetUpload();
}
</script>
</body>
</html>
